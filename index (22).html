<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Live Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom fonts and animations */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes telegramMessageIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .animate-form { animation: fadeInUp 0.5s ease-out; }
    .animate-dashboard { animation: fadeInScale 0.5s ease-out; }
    .animate-menu-item { animation: slideInLeft 0.3s ease-out forwards; }
    .animate-message { animation: telegramMessageIn 0.3s ease-out; }
    .animate-card { animation: fadeInUp 0.5s ease-out forwards; }
    .animate-reaction { animation: pulse 0.2s ease; }
    body { font-family: 'Inter', sans-serif; background: linear-gradient(to bottom right, #e0f2ff, #a5b4fc); }
    .login-container, .signin-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #4b5563, #1e40af);
    }
    .login-card, .signin-card {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      padding: 2.5rem;
      width: 100%;
      max-width: 450px;
      backdrop-filter: blur(10px);
    }
    .login-card input:focus, .signin-card input:focus,
    .login-card select:focus, .signin-card select:focus {
      outline: none;
      border-color: #0088cc;
      box-shadow: 0 0 5px rgba(0, 136, 204, 0.5);
    }
    .login-btn, .signin-btn {
      transition: transform 0.2s ease, background-color 0.2s ease;
    }
    .login-btn:hover, .signin-btn:hover {
      transform: scale(1.05);
      background-color: #006ba0;
    }
    .dashboard-container {
      display: flex;
      min-height: 100vh;
      background: linear-gradient(135deg, #e5e7eb, #a5b4fc);
      position: relative;
    }
    .sidebar {
      width: 250px;
      background: #1e3a8a;
      color: white;
      padding: 1.5rem;
      border-radius: 0 1rem 1rem 0;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }
    .sidebar a {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      margin: 0.5rem 0;
      border-radius: 0.5rem;
      transition: background-color 0.2s ease, transform 0.2s ease, border-left 0.2s ease;
    }
    .sidebar a:hover {
      background: #0088cc;
      transform: translateX(5px);
    }
    .sidebar a.active {
      border-left: 4px solid #fff;
      background: #0088cc;
    }
    .content-area {
      flex-grow: 1;
      padding: 2rem;
    }
    .content-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 1.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      max-width: 900px;
      margin: 0 auto;
      backdrop-filter: blur(5px);
    }
    .hero-banner {
      background: linear-gradient(90deg, #0088cc, #1d4ed8);
      color: white;
      border-radius: 1rem;
      padding: 2rem;
      text-align: center;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3);
    }
    .hero-media {
      width: 100%;
      height: 150px;
      background: #d1d5db;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-weight: 500;
    }
    .stat-card, .link-card, .notification-card, .task-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border-radius: 1rem;
    }
    .stat-card:hover, .link-card:hover, .notification-card:hover, .task-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.25rem;
      text-align: center;
    }
    .calendar-day {
      padding: 0.5rem;
      border-radius: 0.25rem;
    }
    .calendar-day.today {
      background: #ffcc00;
      color: #000;
      font-weight: bold;
    }
    .calendar-day.event {
      background: #0088cc;
      color: white;
    }
    .live-clock {
      font-size: 1rem;
      color: #fff;
      background: rgba(0, 0, 0, 0.5);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      text-align: center;
      margin-top: auto;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease;
    }
    .live-clock:hover {
      transform: scale(1.05);
    }
    /* Telegram-inspired chat styles */
    .telegram-chat-container {
      display: flex;
      height: 100vh;
      background: #f0f0f0;
      border-radius: 1rem;
      overflow: hidden;
    }
    .telegram-sidebar {
      width: 300px;
      background: #f0f0f0;
      border-right: 1px solid #e0e0e0;
      padding: 1rem;
      overflow-y: auto;
    }
    .telegram-search {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: white;
      border-radius: 1rem;
      border: 1px solid #e0e0e0;
      transition: border-color 0.2s ease;
    }
    .telegram-search:focus {
      border-color: #0088cc;
      box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
    }
    .telegram-conversation {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border-radius: 1rem;
      transition: background-color 0.2s ease;
      cursor: pointer;
      margin-bottom: 0.5rem;
    }
    .telegram-conversation:hover, .telegram-conversation.selected {
      background: #e0f2ff;
    }
    .telegram-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #0088cc;
      margin-right: 1rem;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .telegram-conversation-info {
      flex-grow: 1;
    }
    .telegram-conversation-name {
      font-weight: 600;
      color: #000;
    }
    .telegram-preview {
      font-size: 0.875rem;
      color: #666;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .telegram-timestamp {
      font-size: 0.75rem;
      color: #999;
    }
    .telegram-unread {
      background: #0088cc;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-left: 0.5rem;
    }
    .telegram-main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background: #fff;
    }
    .telegram-header {
      padding: 1rem;
      background: #0088cc;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .telegram-chat-title {
      font-weight: 600;
      font-size: 1.1rem;
    }
    .telegram-secret-toggle {
      background: none;
      border: 1px solid white;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    .telegram-messages {
      flex-grow: 1;
      padding: 1.5rem;
      overflow-y: auto;
      background: #e5e5e5 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="%23fff" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="%23fff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>') repeat;
    }
    .telegram-message-bubble {
      max-width: 70%;
      padding: 0.75rem 1rem;
      border-radius: 1.125rem;
      margin-bottom: 0.75rem;
      position: relative;
      word-wrap: break-word;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: opacity 0.3s ease;
    }
    .telegram-message-bubble.edited {
      opacity: 0.8;
    }
    .telegram-message-bubble.sender {
      background: #0088cc;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 0.25rem;
    }
    .telegram-message-bubble.sender::before {
      content: '';
      position: absolute;
      bottom: 0;
      right: 1rem;
      width: 0;
      height: 0;
      border: 8px solid transparent;
      border-left-color: #0088cc;
      border-right: 0;
      margin-bottom: -0.5rem;
    }
    .telegram-message-bubble.receiver {
      background: white;
      color: #000;
      margin-right: auto;
      border-bottom-left-radius: 0.25rem;
    }
    .telegram-message-bubble.receiver::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 1rem;
      width: 0;
      height: 0;
      border: 8px solid transparent;
      border-right-color: white;
      border-left: 0;
      margin-bottom: -0.5rem;
    }
    .telegram-message-time {
      font-size: 0.75rem;
      color: #999;
      text-align: right;
      margin-top: 0.25rem;
    }
    .telegram-message-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.25rem;
      font-size: 0.75rem;
    }
    .telegram-message-actions button {
      background: none;
      border: none;
      color: #0088cc;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: background 0.2s ease;
    }
    .telegram-message-actions button:hover {
      background: #e0f2ff;
    }
    .telegram-reactions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.25rem;
      font-size: 0.875rem;
    }
    .telegram-reaction {
      background: #f0f0f0;
      border-radius: 1rem;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .telegram-reaction:hover {
      background: #e0e0e0;
    }
    .telegram-reaction.active {
      background: #e0f2ff;
      color: #0088cc;
    }
    .telegram-input-container {
      display: flex;
      align-items: flex-end;
      padding: 1rem;
      background: white;
      border-top: 1px solid #e0e0e0;
      gap: 0.5rem;
    }
    .telegram-emoji-btn, .telegram-attach-btn, .telegram-schedule-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #0088cc;
      padding: 0.5rem;
      transition: transform 0.2s ease;
    }
    .telegram-emoji-btn:hover, .telegram-attach-btn:hover, .telegram-schedule-btn:hover {
      transform: scale(1.1);
    }
    .telegram-input {
      flex-grow: 1;
      padding: 0.75rem 1rem;
      border: 1px solid #e0e0e0;
      border-radius: 1.5rem;
      resize: none;
      min-height: 2.5rem;
      max-height: 6rem;
      outline: none;
      transition: border-color 0.2s ease;
    }
    .telegram-input:focus {
      border-color: #0088cc;
      box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
    }
    .telegram-send-btn {
      background: #0088cc;
      color: white;
      border: none;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    .telegram-send-btn:hover {
      background: #006ba0;
    }
    .telegram-typing {
      font-style: italic;
      color: #666;
      padding: 0.5rem;
    }
    .announcement-card {
      background: white;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }
    .announcement-card:hover {
      transform: translateY(-3px);
    }
    .announcement-reactions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      font-size: 0.875rem;
    }
    .announcement-reaction {
      background: #f0f0f0;
      border-radius: 1rem;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .announcement-reaction:hover {
      background: #e0e0e0;
    }
    .announcement-reaction.active {
      background: #e0f2ff;
      color: #0088cc;
    }
    .stories-placeholder {
      background: #f0f0f0;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      text-align: center;
      color: #666;
      position: relative;
    }
    .add-story-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: #0088cc;
      color: white;
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .add-story-btn:hover {
      transform: scale(1.1);
    }
    .story-item {
      display: inline-block;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #d1d5db;
      margin: 0.5rem;
      position: relative;
      cursor: pointer;
    }
    .story-item::before {
      content: attr(data-name);
      position: absolute;
      bottom: -1.5rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #666;
    }
    .profile-picture {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .edit-profile-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .user-card, .message-card, .task-card {
      background: white;
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
    }
    .user-card:hover, .message-card:hover, .task-card:hover {
      transform: translateY(-3px);
    }
    .user-column {
      background: #f9fafb;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .message-column {
      background: #f9fafb;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
    }
    .search-message-input {
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: white;
      border-radius: 1rem;
      border: 1px solid #e0e0e0;
      transition: border-color 0.2s ease;
    }
    .search-message-input:focus {
      border-color: #0088cc;
      box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
    }
    .task-edit-input {
      width: 100%;
      margin-bottom: 0.5rem;
    }
    @media (max-width: 640px) {
      .dashboard-container { flex-direction: column; }
      .sidebar { width: 100%; border-radius: 1rem; }
      .telegram-chat-container { height: 80vh; }
      .telegram-sidebar { width: 100%; height: auto; max-height: 30%; }
      .telegram-main { height: 70%; }
      .telegram-message-bubble { max-width: 85%; }
      .content-card { padding: 1rem; }
      .hero-media { height: 100px; }
      .live-clock { font-size: 0.9rem; padding: 0.4rem 0.8rem; }
    }
  </style>
</head>
<body>
  <!-- Main Container -->
  <div id="app">
    <!-- Sign-In Section -->
    <div id="signin-section" class="signin-container hidden">
      <div class="signin-card animate-form">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">Sign In</h1>
        <form id="signin-form">
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Registration Number</label>
            <input type="text" id="reg-number" class="w-full p-3 border rounded-lg transition-all duration-200" placeholder="Enter Reg Number" required>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Password</label>
            <input type="password" id="password" class="w-full p-3 border rounded-lg transition-all duration-200" placeholder="Enter Password" required>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Gender</label>
            <select id="gender" class="w-full p-3 border rounded-lg">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-1">Status</label>
            <select id="status" class="w-full p-3 border rounded-lg">
              <option value="Private">Private</option>
              <option value="Scholarship">Scholarship</option>
            </select>
          </div>
          <button type="submit" class="bg-blue-500 text-white p-3 rounded-lg w-full font-semibold signin-btn">Sign In</button>
        </form>
        <p class="mt-4 text-center text-gray-600">Already registered? <a href="#" id="show-login" class="text-blue-500 hover:underline">Log In</a></p>
      </div>
    </div>

    <!-- Login Section -->
    <div id="login-section" class="login-container">
      <div class="login-card animate-form">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-800">Log In</h1>
        <form id="login-form">
          <div class="mb-4">
            <label class="block text-gray-700 font-medium mb-1">Registration Number</label>
            <input type="text" id="login-reg-number" class="w-full p-3 border rounded-lg transition-all duration-200" placeholder="Enter Reg Number" required>
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-1">Password</label>
            <input type="password" id="login-password" class="w-full p-3 border rounded-lg transition-all duration-200" placeholder="Enter Password" required>
          </div>
          <button type="submit" class="bg-blue-500 text-white p-3 rounded-lg w-full font-semibold login-btn">Log In</button>
        </form>
        <p class="mt-4 text-center text-gray-600">Need to register? <a href="#" id="show-signin" class="text-blue-500 hover:underline">Sign In</a></p>
      </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboard-section" class="dashboard-container hidden">
      <div class="sidebar">
        <h2 class="text-xl font-bold mb-4">Menu</h2>
        <a href="#" class="text-white animate-menu-item" style="animation-delay: 0.1s;" data-section="home">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
          Home
        </a>
        <a href="#" class="text-white animate-menu-item" style="animation-delay: 0.2s;" data-section="chat">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-5.807C3.117 13.36 3 12.12 3 11c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
          Chat
        </a>
        <a href="#" class="text-white animate-menu-item" style="animation-delay: 0.3s;" data-section="announcements">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.379c4.12 0 7.479 3.582 7.479 8s-3.359 8-7.479 8H7"></path></svg>
          Announcements
        </a>
        <a href="#" class="text-white animate-menu-item" style="animation-delay: 0.4s;" data-section="profile">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
          Profile
        </a>
        <a href="#" id="signout-btn" class="text-white bg-red-500 mt-4 hover:bg-red-600">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
          Sign Out
        </a>
        <div id="live-clock" class="live-clock mt-4"></div>
      </div>
      <div class="content-area">
        <div id="home" class="content-card animate-dashboard">
          <div class="hero-banner mb-6">
            <div class="hero-media">Placeholder: School Logo or Welcome Video</div>
            <h2 class="text-2xl font-bold">Welcome, <span id="user-name"></span>!</h2>
            <p class="text-sm mt-2">Your hub for school communication and updates.</p>
          </div>
          <div class="stories-placeholder">
            Stories: View recent updates from classmates (Coming soon)
            <button id="add-story-btn" class="add-story-btn">+</button>
            <div class="story-item" data-name="Friend1"></div>
            <div class="story-item" data-name="Friend2"></div>
            <div class="story-item" data-name="Friend3"></div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="stat-card bg-white p-4 rounded-lg shadow animate-card" style="animation-delay: 0.1s;">
              <h3 class="text-lg font-semibold mb-2">Quick Stats</h3>
              <p>Attendance: <span class="font-bold">95%</span></p>
              <p>Unread Messages: <span class="font-bold" id="unread-messages">0</span></p>
              <p>Fees Status: <span id="fees-status">80% Paid</span></p>
              <p>Upcoming Events: <span class="font-bold">3</span></p>
              <p>Course Progress: <span class="font-bold">70%</span></p>
            </div>
            <div class="stat-card bg-white p-4 rounded-lg shadow animate-card" style="animation-delay: 0.2s;">
              <h3 class="text-lg font-semibold mb-2">Notifications</h3>
              <div id="notifications">
                <div class="notification-card bg-yellow-100 p-3 rounded-lg mb-2 flex justify-between items-center">
                  <span>Fees due in 5 days</span>
                  <button class="text-gray-500 hover:text-gray-700 dismiss-btn">‚úï</button>
                </div>
                <div class="notification-card bg-blue-100 p-3 rounded-lg mb-2 flex justify-between items-center">
                  <span>New message received</span>
                  <button class="text-gray-500 hover:text-gray-700 dismiss-btn">‚úï</button>
                </div>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="stat-card bg-white p-4 rounded-lg shadow animate-card" style="animation-delay: 0.3s;">
              <h3 class="text-lg font-semibold mb-2">Recent Announcements</h3>
              <div id="recent-announcements" class="text-sm"></div>
            </div>
            <div class="stat-card bg-white p-4 rounded-lg shadow animate-card" style="animation-delay: 0.4s;">
              <h3 class="text-lg font-semibold mb-2">Calendar</h3>
              <div id="calendar" class="calendar"></div>
            </div>
          </div>
          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2">Tasks</h3>
            <div id="task-list">
              <div class="task-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center animate-card" style="animation-delay: 0.5s;">
                <span>Math Assignment - Due: 2025-09-15</span>
                <input type="checkbox" class="task-checkbox">
              </div>
              <div class="task-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center animate-card" style="animation-delay: 0.6s;">
                <span>Team Meeting - Due: 2025-09-16</span>
                <input type="checkbox" class="task-checkbox">
              </div>
            </div>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-2">Quick Links</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 0.7s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                Timetable
              </a>
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 0.8s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Fees
              </a>
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 0.9s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                Assignments
              </a>
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 1.0s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                Library
              </a>
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 1.1s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                Exam Results
              </a>
              <a href="#" class="link-card bg-blue-100 p-3 rounded-lg text-center hover:bg-blue-200 flex items-center justify-center animate-card" style="animation-delay: 1.3s;">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                Support
              </a>
            </div>
          </div>
        </div>
        <div id="chat" class="content-card animate-dashboard hidden">
          <div class="telegram-chat-container">
            <div class="telegram-sidebar">
              <input type="text" class="telegram-search" placeholder="Search chats...">
              <h3 class="text-lg font-semibold mb-4">Conversations</h3>
              <div id="conversation-list"></div>
              <input id="follow-user" class="p-2 border rounded w-full mt-4" placeholder="Enter friend's reg number to start chat">
              <button id="follow-btn" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 w-full mt-2">Follow & Start Chat</button>
            </div>
            <div class="telegram-main">
              <div class="telegram-header">
                <div class="telegram-chat-title">Select a conversation</div>
                <div>
                  <button id="secret-chat-toggle" class="telegram-secret-toggle">Secret Chat: Off</button>
                </div>
              </div>
              <div id="messages" class="telegram-messages"></div>
              <div class="telegram-input-container">
                <button class="telegram-emoji-btn">üòä</button>
                <textarea id="chat-input" class="telegram-input" placeholder="Type a message..." rows="1"></textarea>
                <button class="telegram-attach-btn">üìé</button>
                <button class="telegram-schedule-btn">üïí</button>
                <button id="send-btn" class="telegram-send-btn">‚Üí</button>
              </div>
            </div>
          </div>
        </div>
        <div id="announcements" class="content-card animate-dashboard hidden">
          <h3 class="text-lg font-semibold mb-4">Announcements</h3>
          <div id="announcements-content" class="text-gray-600"></div>
        </div>
        <div id="profile" class="content-card animate-dashboard hidden">
          <h3 class="text-lg font-semibold mb-4">Profile</h3>
          <img id="profile-picture" class="profile-picture" src="" alt="Profile Picture">
          <p><strong>Registration Number:</strong> <span id="profile-reg-number"></span></p>
          <p><strong>Gender:</strong> <span id="profile-gender"></span></p>
          <p><strong>Status:</strong> <span id="profile-status"></span></p>
          <p><strong>Fees:</strong> <span id="fees-status">80% Paid</span></p>
          <p><strong>Bio:</strong> <span id="profile-bio"></span></p>
          <p><strong>Email:</strong> <span id="profile-email"></span></p>
          <button id="edit-profile-btn" class="edit-profile-btn">Edit Profile</button>
          <form id="edit-profile-form" class="edit-profile-form hidden">
            <label for="edit-gender">Gender:</label>
            <select id="edit-gender" class="w-full p-2 border rounded">
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
            <label for="edit-status">Status:</label>
            <select id="edit-status" class="w-full p-2 border rounded">
              <option value="Private">Private</option>
              <option value="Scholarship">Scholarship</option>
            </select>
            <label for="edit-bio">Bio:</label>
            <textarea id="edit-bio" class="w-full p-2 border rounded" placeholder="Enter your bio"></textarea>
            <label for="edit-email">Email:</label>
            <input type="email" id="edit-email" class="w-full p-2 border rounded" placeholder="Enter your email">
            <label for="edit-profile-picture">Profile Picture:</label>
            <input type="file" id="edit-profile-picture" accept="image/*">
            <button type="submit" class="save-profile-btn">Save Changes</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Admin Section -->
    <div id="admin-section" class="hidden container mx-auto p-4 max-w-4xl">
      <h1 class="text-2xl font-bold mb-4 text-blue-600">Admin Panel</h1>
      <div class="bg-white p-6 rounded-lg shadow-md animate-card">
        <div class="mb-4">
          <h3 class="text-lg font-semibold text-blue-500">Post Announcement</h3>
          <input id="announcement-input" class="w-full p-2 border rounded" placeholder="Enter announcement">
          <button id="post-announcement" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600 mt-2">Post</button>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-green-500">Reports</h3>
          <button id="daily-report" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600">Daily Report</button>
        </div>
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-purple-500">User Management</h3>
          <div class="grid grid-cols-2 gap-4 mt-2">
            <div class="user-column">
              <h4 class="text-md font-medium mb-2">Private Students</h4>
              <div id="private-users"></div>
            </div>
            <div class="user-column">
              <h4 class="text-md font-medium mb-2">Scholarship Students</h4>
              <div id="scholarship-users"></div>
            </div>
          </div>
        </div>
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-orange-500">Message Moderation</h3>
          <div id="message-list" class="mt-2"></div>
        </div>
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-red-500">Task Management</h3>
          <input id="task-title" class="w-full p-2 border rounded mt-2" placeholder="Enter task title">
          <input id="task-due-date" type="date" class="w-full p-2 border rounded mt-2" placeholder="Enter due date">
          <button id="post-task" class="bg-green-500 text-white p-2 rounded hover:bg-green-600 mt-2">Post Task</button>
          <div id="task-list-admin" class="mt-4"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mock backend using localStorage
    const db = {
      students: JSON.parse(localStorage.getItem('students')) || [],
      messages: JSON.parse(localStorage.getItem('messages')) || [],
      announcements: JSON.parse(localStorage.getItem('announcements')) || [],
      tasks: JSON.parse(localStorage.getItem('tasks')) || [],
      save: function() {
        localStorage.setItem('students', JSON.stringify(this.students));
        localStorage.setItem('messages', JSON.stringify(this.messages));
        localStorage.setItem('announcements', JSON.stringify(this.announcements));
        localStorage.setItem('tasks', JSON.stringify(this.tasks));
      }
    };

    // Current user
    let currentUser = null;
    let currentChatUser = null;

    // Mock MIS validation
    function validateMIS(regNumber, password) {
      console.log(`Validating MIS for regNumber: ${regNumber}`);
      return true; // Simulate successful validation
    }

    // Helper to show/hide sections
    function showSection(sectionId) {
      document.querySelectorAll('#app > div').forEach(section => section.classList.add('hidden'));
      document.getElementById(sectionId).classList.remove('hidden');
    }

    // Helper to show/hide dashboard content
    function showDashboardContent(sectionId) {
      document.querySelectorAll('.content-card').forEach(card => card.classList.add('hidden'));
      document.getElementById(sectionId).classList.remove('hidden');
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-section') === sectionId) {
          link.classList.add('active');
        }
      });
    }

    // Sign-In Form
    document.getElementById('signin-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const regNumber = document.getElementById('reg-number').value.trim();
      const password = document.getElementById('password').value;
      const gender = document.getElementById('gender').value;
      const status = document.getElementById('status').value;

      if (!regNumber || !password) {
        alert('Please fill in all fields');
        return;
      }

      if (db.students.find(s => s.reg_number === regNumber)) {
        alert('Registration number already exists');
        return;
      }

      if (validateMIS(regNumber, password)) {
        db.students.push({ reg_number: regNumber, password, gender, status, bio: '', email: '', profilePicture: '' });
        db.save();
        alert('Registration successful! Please log in.');
        showSection('login-section');
        document.getElementById('signin-form').reset();
      } else {
        alert('MIS validation failed. Please try again.');
      }
    });

    // Login Form
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const regNumber = document.getElementById('login-reg-number').value.trim();
      const password = document.getElementById('login-password').value;

      console.log(`Attempting login for regNumber: ${regNumber}`);

      if (!regNumber || !password) {
        alert('Please enter both registration number and password');
        return;
      }

      const student = db.students.find(s => s.reg_number === regNumber);
      if (!student) {
        console.log(`User not found: ${regNumber}`);
        alert('User not found. Please check your registration number or sign in.');
        document.getElementById('login-form').reset();
        return;
      }

      if (student.password !== password) {
        console.log(`Incorrect password for ${regNumber}`);
        alert('Incorrect password. Please try again.');
        document.getElementById('login-password').value = '';
        return;
      }

      console.log(`Login successful for ${regNumber}`);
      currentUser = student;
      if (regNumber === 'admin') {
        showSection('admin-section');
        loadAdminPanel();
      } else {
        document.getElementById('user-name').textContent = regNumber;
        document.getElementById('profile-reg-number').textContent = regNumber;
        document.getElementById('profile-gender').textContent = student.gender;
        document.getElementById('profile-status').textContent = student.status;
        document.getElementById('profile-bio').textContent = student.bio || 'No bio yet';
        document.getElementById('profile-email').textContent = student.email || 'No email yet';
        document.getElementById('profile-picture').src = student.profilePicture || 'https://via.placeholder.com/120?text=Profile';
        showSection('dashboard-section');
        showDashboardContent('home');
        loadHomeContent();
        loadConversationList();
      }
      document.getElementById('login-form').reset();
    });

    // Toggle between sign-in and login
    document.getElementById('show-login').addEventListener('click', (e) => {
      e.preventDefault();
      showSection('login-section');
    });
    document.getElementById('show-signin').addEventListener('click', (e) => {
      e.preventDefault();
      showSection('signin-section');
    });

    // Sign Out
    document.getElementById('signout-btn').addEventListener('click', () => {
      currentUser = null;
      currentChatUser = null;
      showSection('login-section');
    });

    // Dashboard Menu Navigation
    document.querySelectorAll('.sidebar a[data-section]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const section = link.getAttribute('data-section');
        showDashboardContent(section);
        if (section === 'home') loadHomeContent();
        if (section === 'chat') loadConversationList();
        if (section === 'announcements') loadAnnouncements();
        if (section === 'profile') loadProfile();
      });
    });

    // Load Home Content
    function loadHomeContent() {
      const recentAnnouncementsDiv = document.getElementById('recent-announcements');
      recentAnnouncementsDiv.innerHTML = db.announcements
        .slice(-3)
        .map((a, index) => `
          <div class="announcement-card animate-card" style="animation-delay: ${0.1 * index}s;">
            <p class="text-gray-600">${a.content}</p>
            <p class="text-sm text-gray-400">${a.timestamp}</p>
            <div class="announcement-reactions" data-announcement-id="${index}">
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üëç' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üëç">üëç ${a.reactions?.find(r => r.emoji === 'üëç')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === '‚ù§Ô∏è' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è ${a.reactions?.find(r => r.emoji === '‚ù§Ô∏è')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üòÑ' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üòÑ">üòÑ ${a.reactions?.find(r => r.emoji === 'üòÑ')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üò¢' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üò¢">üò¢ ${a.reactions?.find(r => r.emoji === 'üò¢')?.count || 0}</span>
            </div>
          </div>
        `)
        .join('');
      
      // Unread Messages
      const unreadMessages = db.messages.filter(m => m.receiver === currentUser.reg_number && !m.read).length;
      document.getElementById('unread-messages').textContent = unreadMessages;

      // Dismiss Notifications
      document.querySelectorAll('.dismiss-btn').forEach(btn => {
        btn.removeEventListener('click', dismissHandler);
        btn.addEventListener('click', dismissHandler);
      });

      // Task Checkboxes
      document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.removeEventListener('change', taskHandler);
        checkbox.addEventListener('change', taskHandler);
      });

      // Announcement Reactions
      document.querySelectorAll('.announcement-reaction').forEach(btn => {
        btn.removeEventListener('click', handleAnnouncementReaction);
        btn.addEventListener('click', handleAnnouncementReaction);
      });

      // Load dynamic calendar and clock
      loadDynamicCalendar();
      updateLiveClock();
      setInterval(updateLiveClock, 1000);
    }

    // Dynamic Calendar
    function loadDynamicCalendar() {
      const calendarDiv = document.getElementById('calendar');
      const date = new Date();
      const month = date.getMonth();
      const year = date.getFullYear();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = date.getDate();

      calendarDiv.innerHTML = `
        <div class="font-semibold">Sun</div><div class="font-semibold">Mon</div><div class="font-semibold">Tue</div><div class="font-semibold">Wed</div><div class="font-semibold">Thu</div><div class="font-semibold">Fri</div><div class="font-semibold">Sat</div>
      `;
      for (let i = 0; i < firstDay; i++) {
        calendarDiv.innerHTML += `<div class="calendar-day"></div>`;
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const isToday = day === today ? 'today' : '';
        const isEvent = [3, 9, 18].includes(day) ? 'event' : '';
        calendarDiv.innerHTML += `<div class="calendar-day ${isToday} ${isEvent}" data-day="${day}">${day}</div>`;
      }
      document.querySelectorAll('.calendar-day[data-day]').forEach(day => {
        day.addEventListener('click', () => alert(`Event on ${day.getAttribute('data-day')}`));
      });
    }

    // Live Clock
    function updateLiveClock() {
      const clockDiv = document.getElementById('live-clock');
      const now = new Date();
      clockDiv.textContent = now.toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }

    // Handlers for dismiss and task checkboxes
    function dismissHandler(e) {
      e.target.parentElement.remove();
    }

    function taskHandler(e) {
      const taskCard = e.target.parentElement;
      taskCard.style.opacity = e.target.checked ? '0.7' : '1';
    }

    // Handle Announcement Reactions
    function handleAnnouncementReaction(e) {
      const emoji = e.target.getAttribute('data-emoji');
      const announcementId = parseInt(e.target.parentElement.getAttribute('data-announcement-id'));
      const announcement = db.announcements[db.announcements.length - 1 - announcementId]; // Reverse index for recent

      if (!announcement.reactions) announcement.reactions = [];
      let reaction = announcement.reactions.find(r => r.emoji === emoji);

      if (!reaction) {
        reaction = { emoji, users: [], count: 0 };
        announcement.reactions.push(reaction);
      }

      if (reaction.users.includes(currentUser.reg_number)) {
        reaction.users = reaction.users.filter(u => u !== currentUser.reg_number);
        reaction.count--;
      } else {
        reaction.users.push(currentUser.reg_number);
        reaction.count++;
      }

      if (reaction.count === 0) {
        announcement.reactions = announcement.reactions.filter(r => r.emoji !== emoji);
      }

      db.save();
      loadHomeContent();
      if (document.getElementById('announcements').classList.contains('hidden')) return;
      loadAnnouncements();
    }

    // Load Announcements
    function loadAnnouncements() {
      const announcementsDiv = document.getElementById('announcements-content');
      announcementsDiv.innerHTML = db.announcements
        .map((a, index) => `
          <div class="announcement-card animate-card" style="animation-delay: ${0.1 * index}s;">
            <p class="text-gray-600">${a.content}</p>
            <p class="text-sm text-gray-400">${a.timestamp}</p>
            <div class="announcement-reactions" data-announcement-id="${db.announcements.length - 1 - index}">
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üëç' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üëç">üëç ${a.reactions?.find(r => r.emoji === 'üëç')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === '‚ù§Ô∏è' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è ${a.reactions?.find(r => r.emoji === '‚ù§Ô∏è')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üòÑ' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üòÑ">üòÑ ${a.reactions?.find(r => r.emoji === 'üòÑ')?.count || 0}</span>
              <span class="announcement-reaction ${a.reactions?.find(r => r.emoji === 'üò¢' && r.users.includes(currentUser.reg_number)) ? 'active' : ''}" data-emoji="üò¢">üò¢ ${a.reactions?.find(r => r.emoji === 'üò¢')?.count || 0}</span>
            </div>
          </div>
        `)
        .join('');

      document.querySelectorAll('.announcement-reaction').forEach(btn => {
        btn.removeEventListener('click', handleAnnouncementReaction);
        btn.addEventListener('click', handleAnnouncementReaction);
      });
    }

    // Post Announcement (Admin)
    document.getElementById('post-announcement').addEventListener('click', () => {
      const content = document.getElementById('announcement-input').value.trim();
      if (content) {
        db.announcements.push({ content, timestamp: new Date().toISOString(), reactions: [] });
        db.save();
        loadAnnouncements();
        loadHomeContent();
        document.getElementById('announcement-input').value = '';
      }
    });

    // Follow User
    document.getElementById('follow-btn').addEventListener('click', () => {
      const followReg = document.getElementById('follow-user').value.trim();
      if (!followReg) {
        alert('Please enter a registration number');
        return;
      }
      if (db.students.find(s => s.reg_number === followReg)) {
        alert(`Started chat with ${followReg}`);
        if (!db.messages.find(m => (m.sender === currentUser.reg_number && m.receiver === followReg) || (m.sender === followReg && m.receiver === currentUser.reg_number))) {
          db.messages.push({ sender: currentUser.reg_number, receiver: followReg, content: `Hello! Let's chat.`, timestamp: new Date().toISOString(), read: false, reactions: [], editCount: 0, isForwarded: false, forwardedFrom: null, isScheduled: false, sendTime: null, isSecret: false });
          db.save();
        }
        loadConversationList();
        document.getElementById('follow-user').value = '';
      } else {
        alert('User not found');
      }
    });

    // Load Conversation List
    function loadConversationList() {
      const conversationList = document.getElementById('conversation-list');
      const conversations = db.messages
        .filter(m => m.sender === currentUser.reg_number || m.receiver === currentUser.reg_number)
        .map(m => m.sender === currentUser.reg_number ? m.receiver : m.sender)
        .filter((v, i, a) => a.indexOf(v) === i);
      conversationList.innerHTML = conversations
        .map(user => {
          const lastMessage = db.messages.filter(m => (m.sender === user && m.receiver === currentUser.reg_number) || (m.sender === currentUser.reg_number && m.receiver === user)).slice(-1)[0];
          const unreadCount = db.messages.filter(m => m.receiver === currentUser.reg_number && m.sender === user && !m.read).length;
          return `
            <div class="telegram-conversation ${currentChatUser === user ? 'selected' : ''}" data-user="${user}">
              <div class="telegram-avatar">${user.charAt(0).toUpperCase()}</div>
              <div class="telegram-conversation-info">
                <div class="telegram-conversation-name">${user}</div>
                <div class="telegram-preview">${lastMessage ? lastMessage.content.substring(0, 30) + '...' : 'No messages yet'}</div>
              </div>
              <div>
                <div class="telegram-timestamp">${lastMessage ? new Date(lastMessage.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : ''}</div>
                ${unreadCount > 0 ? `<div class="telegram-unread"></div>` : ''}
              </div>
            </div>
          `;
        })
        .join('');
      document.querySelectorAll('.telegram-conversation').forEach(conv => {
        conv.removeEventListener('click', conversationHandler);
        conv.addEventListener('click', conversationHandler);
      });
      if (currentChatUser) {
        document.querySelector(`[data-user="${currentChatUser}"]`).classList.add('selected');
      }
    }

    function conversationHandler(e) {
      currentChatUser = e.currentTarget.getAttribute('data-user');
      document.querySelectorAll('.telegram-conversation').forEach(c => c.classList.remove('selected'));
      e.currentTarget.classList.add('selected');
      document.querySelector('.telegram-chat-title').textContent = currentChatUser;
      loadMessages(currentUser.reg_number, currentChatUser);
    }

    // Handle Message Reactions
    function handleMessageReaction(e) {
      const emoji = e.target.getAttribute('data-emoji');
      const messageId = parseInt(e.target.parentElement.getAttribute('data-message-id'));
      const message = db.messages[messageId];

      if (!message.reactions) message.reactions = [];
      let reaction = message.reactions.find(r => r.emoji === emoji);

      if (!reaction) {
        reaction = { emoji, users: [], count: 0 };
        message.reactions.push(reaction);
      }

      if (reaction.users.includes(currentUser.reg_number)) {
        reaction.users = reaction.users.filter(u => u !== currentUser.reg_number);
        reaction.count--;
      } else {
        reaction.users.push(currentUser.reg_number);
        reaction.count++;
      }

      if (reaction.count === 0) {
        message.reactions = message.reactions.filter(r => r.emoji !== emoji);
      }

      db.save();
      loadMessages(currentUser.reg_number, currentChatUser);
    }

    // Edit Message
    function handleEditMessage(e) {
      const messageId = parseInt(e.target.parentElement.getAttribute('data-message-id'));
      const message = db.messages[messageId];
      if (message.sender !== currentUser.reg_number) {
        alert('You can only edit your own messages');
        return;
      }
      if (message.editCount >= 5) {
        alert('Maximum edit limit reached');
        return;
      }
      const newContent = prompt('Edit message:', message.content);
      if (newContent && newContent.trim()) {
        message.content = newContent.trim();
        message.editCount = (message.editCount || 0) + 1;
        message.timestamp = new Date().toISOString();
        db.save();
        loadMessages(currentUser.reg_number, currentChatUser);
      }
    }

    // Delete Message
    function handleDeleteMessage(e) {
      const messageId = parseInt(e.target.parentElement.getAttribute('data-message-id'));
      const message = db.messages[messageId];
      if (message.sender !== currentUser.reg_number) {
        alert('You can only delete your own messages');
        return;
      }
      if (confirm('Delete this message?')) {
        db.messages.splice(messageId, 1);
        db.save();
        loadMessages(currentUser.reg_number, currentChatUser);
        loadConversationList();
      }
    }

    // Forward Message
    function handleForwardMessage(e) {
      const messageId = parseInt(e.target.parentElement.getAttribute('data-message-id'));
      const message = db.messages[messageId];
      const forwardTo = prompt('Enter registration number to forward to:');
      if (!forwardTo || !db.students.find(s => s.reg_number === forwardTo)) {
        alert('Invalid or non-existent user');
        return;
      }
      db.messages.push({
        sender: currentUser.reg_number,
        receiver: forwardTo,
        content: message.content,
        timestamp: new Date().toISOString(),
        read: false,
        reactions: [],
        editCount: 0,
        isForwarded: true,
        forwardedFrom: message.sender,
        isScheduled: false,
        sendTime: null,
        isSecret: message.isSecret
      });
      db.save();
      alert(`Message forwarded to ${forwardTo}`);
      loadConversationList();
    }

    // Chat System
    const chatInput = document.getElementById('chat-input');
    chatInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      if (this.value.startsWith('@gif ')) {
        const query = this.value.slice(5).trim();
        if (query) {
          const gifUrl = `https://giphy.com/embed/mock-${query.replace(/\s/g, '-')}`;
          this.value = `GIF: ${gifUrl}`;
        }
      }
    });
    document.getElementById('send-btn').addEventListener('click', () => {
      const message = chatInput.value.trim();
      const receiver = currentChatUser;
      const sender = currentUser.reg_number;

      if (!message) {
        alert('Please enter a message');
        return;
      }
      if (!receiver) {
        alert('Please select a conversation');
        return;
      }

      db.messages.push({
        sender,
        receiver,
        content: message,
        timestamp: new Date().toISOString(),
        read: false,
        reactions: [],
        editCount: 0,
        isForwarded: false,
        forwardedFrom: null,
        isScheduled: false,
        sendTime: null,
        isSecret: isSecretChat
      });
      db.save();
      loadMessages(sender, receiver);
      loadConversationList();
      loadHomeContent();
      chatInput.value = '';
      chatInput.style.height = 'auto';
    });

    // Load Messages
    function loadMessages(user, chatUser) {
      const messagesDiv = document.getElementById('messages');
      const filteredMessages = db.messages
        .filter(m => (m.sender === user && m.receiver === chatUser) || (m.sender === chatUser && m.receiver === user))
        .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
      messagesDiv.innerHTML = filteredMessages
        .map((m, index) => {
          const messageId = db.messages.indexOf(m);
          let content = m.content;
          if (m.isForwarded) {
            content = `[Forwarded from ${m.forwardedFrom}] ${content}`;
          }
          return `
            <div class="telegram-message-bubble ${m.sender === user ? 'sender' : 'receiver'} ${m.editCount > 0 ? 'edited' : ''} animate-message" data-message-id="${messageId}">
              ${content}
              <div class="telegram-message-time">${new Date(m.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}${m.editCount > 0 ? ' (Edited)' : ''}</div>
              ${m.sender === user ? `
                <div class="telegram-message-actions">
                  <button class="edit-btn">Edit</button>
                  <button class="delete-btn">Delete</button>
                  <button class="forward-btn">Forward</button>
                </div>
              ` : ''}
              <div class="telegram-reactions" data-message-id="${messageId}">
                <span class="telegram-reaction ${m.reactions?.find(r => r.emoji === 'üëç' && r.users.includes(user)) ? 'active' : ''}" data-emoji="üëç">üëç ${m.reactions?.find(r => r.emoji === 'üëç')?.count || 0}</span>
                <span class="telegram-reaction ${m.reactions?.find(r => r.emoji === '‚ù§Ô∏è' && r.users.includes(user)) ? 'active' : ''}" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è ${m.reactions?.find(r => r.emoji === '‚ù§Ô∏è')?.count || 0}</span>
                <span class="telegram-reaction ${m.reactions?.find(r => r.emoji === 'üòÑ' && r.users.includes(user)) ? 'active' : ''}" data-emoji="üòÑ">üòÑ ${m.reactions?.find(r => r.emoji === 'üòÑ')?.count || 0}</span>
                <span class="telegram-reaction ${m.reactions?.find(r => r.emoji === 'üò¢' && r.users.includes(user)) ? 'active' : ''}" data-emoji="üò¢">üò¢ ${m.reactions?.find(r => r.emoji === 'üò¢')?.count || 0}</span>
              </div>
            </div>
          `;
        })
        .join('');
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      // Mark messages as read
      db.messages.forEach(m => {
        if (m.receiver === user && m.sender === chatUser) m.read = true;
      });
      db.save();
      loadHomeContent();

      // Attach listeners
      document.querySelectorAll('.telegram-reaction').forEach(btn => {
        btn.removeEventListener('click', handleMessageReaction);
        btn.addEventListener('click', handleMessageReaction);
      });
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.removeEventListener('click', handleEditMessage);
        btn.addEventListener('click', handleEditMessage);
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.removeEventListener('click', handleDeleteMessage);
        btn.addEventListener('click', handleDeleteMessage);
      });
      document.querySelectorAll('.forward-btn').forEach(btn => {
        btn.removeEventListener('click', handleForwardMessage);
        btn.addEventListener('click', handleForwardMessage);
      });
    }

    // Daily Report (Mock)
    document.getElementById('daily-report').addEventListener('click', () => {
      alert('Daily Report: ' + JSON.stringify(db.students.length) + ' students registered.');
    });

    // Add Story
    document.getElementById('add-story-btn').addEventListener('click', () => {
      const storyContent = prompt('Enter story content:');
      if (storyContent) {
        alert('Story added! (Mock: Displayed in stories placeholder)');
        // Mock adding story - in real app, save to db and display
      }
    });

    // Edit Profile
    document.getElementById('edit-profile-btn').addEventListener('click', () => {
      const form = document.getElementById('edit-profile-form');
      form.classList.toggle('hidden');
      document.getElementById('edit-gender').value = currentUser.gender;
      document.getElementById('edit-status').value = currentUser.status;
      document.getElementById('edit-bio').value = currentUser.bio || '';
      document.getElementById('edit-email').value = currentUser.email || '';
    });

    document.getElementById('edit-profile-form').addEventListener('submit', (e) => {
      e.preventDefault();
      currentUser.gender = document.getElementById('edit-gender').value;
      currentUser.status = document.getElementById('edit-status').value;
      currentUser.bio = document.getElementById('edit-bio').value.trim();
      currentUser.email = document.getElementById('edit-email').value.trim();
      const fileInput = document.getElementById('edit-profile-picture');
      if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
          currentUser.profilePicture = e.target.result;
          db.save();
          loadProfile();
        };
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        db.save();
        loadProfile();
      }
      document.getElementById('edit-profile-form').classList.add('hidden');
      alert('Profile updated!');
    });

    function loadProfile() {
      document.getElementById('profile-gender').textContent = currentUser.gender;
      document.getElementById('profile-status').textContent = currentUser.status;
      document.getElementById('profile-bio').textContent = currentUser.bio || 'No bio yet';
      document.getElementById('profile-email').textContent = currentUser.email || 'No email yet';
      document.getElementById('profile-picture').src = currentUser.profilePicture || 'https://via.placeholder.com/120?text=Profile';
    }

    // Load Admin Panel
    function loadAdminPanel() {
      // User List - Separate by status
      const privateUsers = db.students.filter(u => u.status === 'Private');
      const scholarshipUsers = db.students.filter(u => u.status === 'Scholarship');

      document.getElementById('private-users').innerHTML = privateUsers
        .map((user, index) => `
          <div class="user-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center">
            <span>${user.reg_number} (${user.gender})</span>
            <div>
              <button class="edit-user-btn" data-index="${index}">Edit</button>
              <button class="delete-user-btn" data-index="${index}">Delete</button>
            </div>
          </div>
        `)
        .join('');

      document.getElementById('scholarship-users').innerHTML = scholarshipUsers
        .map((user, index) => `
          <div class="user-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center">
            <span>${user.reg_number} (${user.gender})</span>
            <div>
              <button class="edit-user-btn" data-index="${index + privateUsers.length}">Edit</button>
              <button class="delete-user-btn" data-index="${index + privateUsers.length}">Delete</button>
            </div>
          </div>
        `)
        .join('');

      document.querySelectorAll('.edit-user-btn').forEach(btn => {
        btn.removeEventListener('click', handleEditUser);
        btn.addEventListener('click', handleEditUser);
      });
      document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.removeEventListener('click', handleDeleteUser);
        btn.addEventListener('click', handleDeleteUser);
      });

      // Message List - Separate by user columns (group by sender)
      const messageList = document.getElementById('message-list');
      const uniqueSenders = [...new Set(db.messages.map(m => m.sender))];
      messageList.innerHTML = uniqueSenders
        .map(sender => `
          <div class="message-column">
            <h4 class="text-md font-medium mb-2">${sender}'s Messages</h4>
            ${db.messages.filter(m => m.sender === sender).map((m, index) => `
              <div class="message-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center">
                <span>To ${m.receiver}: ${m.content.substring(0, 50)}...</span>
                <button class="delete-message-btn" data-index="${db.messages.indexOf(m)}">Delete</button>
              </div>
            `).join('')}
          </div>
        `)
        .join('');
      document.querySelectorAll('.delete-message-btn').forEach(btn => {
        btn.removeEventListener('click', handleDeleteMessageAdmin);
        btn.addEventListener('click', handleDeleteMessageAdmin);
      });

      // Task List - With edit/delete
      const taskListAdmin = document.getElementById('task-list-admin');
      taskListAdmin.innerHTML = db.tasks
        .map((task, index) => `
          <div class="task-card bg-white p-3 rounded-lg mb-2 flex justify-between items-center">
            <span>${task.title} - Due: ${task.dueDate}</span>
            <div>
              <button class="edit-task-btn" data-index="${index}">Edit</button>
              <button class="delete-task-btn" data-index="${index}">Delete</button>
            </div>
          </div>
        `)
        .join('');
      document.querySelectorAll('.edit-task-btn').forEach(btn => {
        btn.addEventListener('click', handleEditTask);
      });
      document.querySelectorAll('.delete-task-btn').forEach(btn => {
        btn.addEventListener('click', handleDeleteTask);
      });

      // Analytics
      const analytics = document.getElementById('analytics');
      analytics.innerHTML = `
        <p>Number of Users: ${db.students.length}</p>
        <p>Number of Messages: ${db.messages.length}</p>
        <p>Number of Announcements: ${db.announcements.length}</p>
      `;
    }

    // Edit Task (Admin)
    function handleEditTask(e) {
      const index = parseInt(e.target.getAttribute('data-index'));
      const task = db.tasks[index];
      const newTitle = prompt('Edit Task Title:', task.title);
      const newDueDate = prompt('Edit Due Date (YYYY-MM-DD):', task.dueDate);
      if (newTitle) task.title = newTitle;
      if (newDueDate) task.dueDate = newDueDate;
      db.save();
      loadAdminPanel();
      alert('Task updated!');
    }

    // Delete Task (Admin)
    function handleDeleteTask(e) {
      const index = parseInt(e.target.getAttribute('data-index'));
      if (confirm('Delete this task?')) {
        db.tasks.splice(index, 1);
        db.save();
        loadAdminPanel();
      }
    }

    // Initialize
    showSection('login-section');
  </script>
</body>
</html>